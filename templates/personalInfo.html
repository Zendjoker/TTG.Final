{% extends "base.html" %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static "styles/personalInfo.css" %}">
    {% block title %}
        <title>Tunisian Top Gs | Personal Info</title>
    {% endblock title %}
{% endblock head %}

{% block header %}
{% include "components/navbar.html" %}
{% endblock header %}

{% block main %}
<main>
    <section class="personal-information-section">
        <div class="flex flex-wrap personal-information-body">
            <a href="#" onclick="goBack()"><i data-lucide="undo-2"></i> Go Back</a>
            <div class="flex-col info-cards">
                <span class="h1-text">Personal Information</span>

                <div class="flex card-item">
                    <div class="flex flex-col info-section">
                        <span class="p-text">Username</span>
                        <span class="p-text secondary-text">{{ request.user.username }}</span>
                        <input type="text" name="username" class="edit-field" style="display:none;">
                    </div>
                    <button class="change-btn" onclick="editField(this, 'username')">Change</button>
                </div>

                <div class="flex card-item">
                    <div class="flex flex-col info-section">
                        <span class="p-text">E-mail</span>
                        <span class="p-text secondary-text">{{ request.user.customuser.email|default:"No email" }}</span>
                        <input type="email" name="email" class="edit-field" style="display:none;">
                    </div>
                    <button class="change-btn" onclick="editField(this, 'email')">Change</button>
                </div>

                <div class="flex card-item">
                    <div class="flex flex-col info-section">
                        <span class="p-text">Number</span>
                        <span class="p-text secondary-text">{{ request.user.customuser.tel }}</span>
                        <input type="text" name="tel" class="edit-field" style="display:none;">
                    </div>
                    <button class="change-btn" onclick="editField(this, 'tel')">Change</button>
                </div>

                <div class="flex card-item">
                    <div class="flex flex-col info-section">
                        <span class="p-text">Bio</span>
                        <span class="p-text secondary-text">{{ request.user.customuser.bio }}</span>
                        <input type="text" name="bio" class="edit-field" style="display:none;">
                    </div>
                    <button class="change-btn" onclick="editField(this, 'bio')">Change</button>
                </div>

                <div class="flex card-item">
                    <div class="flex flex-col info-section">
                        <span class="p-text">First Name</span>
                        <span class="p-text secondary-text">{{ request.user.first_name|default:"None" }}</span>
                        <input type="text" name="first_name" class="edit-field" style="display:none;">
                    </div>
                    <button class="change-btn" onclick="editField(this, 'first_name')">Change</button>
                </div>

                <div class="flex card-item">
                    <div class="flex flex-col info-section">
                        <span class="p-text">Last Name</span>
                        <span class="p-text secondary-text">{{ request.user.last_name|default:"None" }}</span>
                        <input type="text" name="last_name" class="edit-field" style="display:none;">
                    </div>
                    <button class="change-btn" onclick="editField(this, 'last_name')">Change</button>
                </div>
            </div>
        </div>
        <div class="flex flex-col flex-center personal-info">
            <div class="flex-container-info">
                <div class="profile-pic">
                    <img src="{{ request.user.customuser.pfp.url }}" />
                </div>

                <div class="profile-name">
                    <span class="h1-text">{{ request.user.first_name|default:"None" }} {{ request.user.last_name|default:"None" }}</span>
                </div>

                <div class="email-information">
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0,0,256,256">
                        <g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt"
                            stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
                            font-family="none" font-weight="none" font-size="none" text-anchor="none"
                            style="mix-blend-mode: normal">
                            <g transform="scale(5.12,5.12)">
                                <path
                                    d="M0,7v36h50v-36zM2,9h46v2.53125l-23,18.1875l-23,-18.1875zM2,14.09375l22.375,17.6875c0.36719,0.29297 0.88281,0.29297 1.25,0l22.375,-17.6875v26.90625h-46z">
                                </path>
                            </g>
                        </g>
                    </svg>
                    <span class="p-text secondary-text">{{ request.user.customuser.email|default:"No email" }}</span>
                </div>

                <div class="badges-profile-edit">
                    {% for badge in request.user.customuser.badges.all %}
                    <img class="badges-g" src="{{ badge.icon.url }}" alt="">
                    {% endfor %}
                </div>


                <div class="flex flex-center profile-stats">
                    <div class="wrap-enrol">
                        <div class="wrap-icon-c">
                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="17" height="17"
                                viewBox="0,0,256,256">
                                <g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt"
                                    stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
                                    font-family="none" font-weight="none" font-size="none" text-anchor="none"
                                    style="mix-blend-mode: normal">
                                    <g transform="scale(10.66667,10.66667)">
                                        <path
                                            d="M19.5,3c-2.48528,0 -4.5,2.01472 -4.5,4.5c0,2.48528 2.01472,4.5 4.5,4.5c2.48528,0 4.5,-2.01472 4.5,-4.5c0,-2.48528 -2.01472,-4.5 -4.5,-4.5zM12.55273,9.10547c-2.26919,1.1343 -3.37319,3.43617 -3.9375,5.58789c-0.29602,-0.56515 -0.56741,-1.15172 -1.0293,-1.59961c-0.65606,-0.63618 -1.55816,-1.09375 -2.58594,-1.09375c-1.02778,0 -1.92988,0.45757 -2.58594,1.09375c-0.65606,0.63618 -1.11549,1.43773 -1.46289,2.27148c-0.69479,1.6675 -0.95117,3.4681 -0.95117,4.63477h2c0,-0.83333 0.24362,-2.53274 0.79883,-3.86523c0.2776,-0.66625 0.63067,-1.23969 1.00586,-1.60352c0.37519,-0.36382 0.72309,-0.53125 1.19531,-0.53125c0.47222,0 0.82012,0.16743 1.19531,0.53125c0.37519,0.36382 0.72826,0.93727 1.00586,1.60352c0.55521,1.3325 0.79883,3.0319 0.79883,3.86523h2c0,-0.96583 0.05672,-2.9156 0.54492,-4.78516c0.4882,-1.86955 1.38203,-3.56036 2.90234,-4.32031z">
                                        </path>
                                    </g>
                                </g>
                            </svg>
                            <span class="p-text-enroll">Enrolled Courses</span>
                        </div>
                        <span class="h1-text-enroll">0</span>
                    </div>
                    <div class="wrap-enrol">
                        <div class="wrap-icon-c">

                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="17" height="17"
                                viewBox="0,0,256,256">
                                <g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt"
                                    stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
                                    font-family="none" font-weight="none" font-size="none" text-anchor="none"
                                    style="mix-blend-mode: normal">
                                    <g transform="scale(5.12,5.12)">
                                        <path
                                            d="M9,4c-2.74545,0 -5,2.25455 -5,5v32c0,2.74546 2.25455,5 5,5h32c2.74546,0 5,-2.25455 5,-5v-32c0,-2.74545 -2.25455,-5 -5,-5zM9,6h32c1.65454,0 3,1.34545 3,3v32c0,1.65454 -1.34546,3 -3,3h-32c-1.65455,0 -3,-1.34546 -3,-3v-32c0,-1.65455 1.34545,-3 3,-3zM25,9.80859l-0.93359,2.43359l-3.06836,7.99414l-11.12891,0.60547l8.60156,7.02734l-2.78125,10.76953l9.31055,-6.04687l9.31055,6.04688l-2.78125,-10.76953l8.60156,-7.02734l-11.12891,-0.60547zM25,15.39258l2.59766,6.77148l7.26953,0.39453l-5.5957,4.57227l1.81836,7.0293l-6.08984,-3.95312l-6.08984,3.95313l1.81836,-7.0293l-5.5957,-4.57227l7.26953,-0.39453z">
                                        </path>
                                    </g>
                                </g>
                            </svg>
                            <span class="p-text-enroll">Points</span>

                        </div>

                        <span class="h1-text-enroll">{{ request.user.customuser.points }}</span>
                    </div>
                    <div class="wrap-enrol">

                        <div class="wrap-icon-c">
                            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="17" height="17"
                                viewBox="0,0,256,256">
                                <g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt"
                                    stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
                                    font-family="none" font-weight="none" font-size="none" text-anchor="none"
                                    style="mix-blend-mode: normal">
                                    <g transform="scale(5.12,5.12)">
                                        <path
                                            d="M25,0c-2.75,0 -5,2.25 -5,5c0,1.39063 0.57422,2.65234 1.5,3.5625l-7.6875,11.8125c-0.56641,-0.22266 -1.16797,-0.375 -1.8125,-0.375c-2.75,0 -5,2.25 -5,5c0,1.82031 1.00391,3.40625 2.46875,4.28125l-3.75,10.78125c-0.23828,-0.03516 -0.47266,-0.0625 -0.71875,-0.0625c-2.75,0 -5,2.25 -5,5c0,2.75 2.25,5 5,5c2.75,0 5,-2.25 5,-5c0,-1.79297 -0.97656,-3.36719 -2.40625,-4.25l3.78125,-10.8125c0.20703,0.02734 0.41016,0.0625 0.625,0.0625c0.21484,0 0.41797,-0.03516 0.625,-0.0625l3.8125,10.78125c-1.44922,0.87891 -2.4375,2.47266 -2.4375,4.28125c0,2.75 2.25,5 5,5c2.75,0 5,-2.25 5,-5c0,-2.75 -2.25,-5 -5,-5c-0.22656,0 -0.4375,0.03125 -0.65625,0.0625l-3.8125,-10.78125c1.46484,-0.875 2.46875,-2.46094 2.46875,-4.28125c0,-1.39062 -0.57422,-2.65234 -1.5,-3.5625l7.6875,-11.8125c0.56641,0.22266 1.16797,0.375 1.8125,0.375c0.64453,0 1.24609,-0.15234 1.8125,-0.375l7.6875,11.8125c-0.92578,0.91016 -1.5,2.17188 -1.5,3.5625c0,1.82031 1.00391,3.40625 2.46875,4.28125l-3.8125,10.78125c-0.21875,-0.03125 -0.42969,-0.0625 -0.65625,-0.0625c-2.75,0 -5,2.25 -5,5c0,2.75 2.25,5 5,5c2.75,0 5,-2.25 5,-5c0,-1.80859 -0.98828,-3.40234 -2.4375,-4.28125l3.8125,-10.78125c0.20703,0.02734 0.41016,0.0625 0.625,0.0625c0.21484,0 0.41797,-0.03516 0.625,-0.0625l3.78125,10.8125c-1.42969,0.88281 -2.40625,2.45703 -2.40625,4.25c0,2.75 2.25,5 5,5c2.75,0 5,-2.25 5,-5c0,-2.75 -2.25,-5 -5,-5c-0.24609,0 -0.48047,0.02734 -0.71875,0.0625l-3.75,-10.78125c1.46484,-0.875 2.46875,-2.46094 2.46875,-4.28125c0,-2.75 -2.25,-5 -5,-5c-0.64453,0 -1.24609,0.15234 -1.8125,0.375l-7.6875,-11.8125c0.92578,-0.91016 1.5,-2.17187 1.5,-3.5625c0,-2.75 -2.25,-5 -5,-5zM25,2c1.66797,0 3,1.33203 3,3c0,1.66797 -1.33203,3 -3,3c-1.66797,0 -3,-1.33203 -3,-3c0,-1.66797 1.33203,-3 3,-3zM12,22c1.66797,0 3,1.33203 3,3c0,1.66797 -1.33203,3 -3,3c-1.66797,0 -3,-1.33203 -3,-3c0,-1.66797 1.33203,-3 3,-3zM38,22c1.66797,0 3,1.33203 3,3c0,1.66797 -1.33203,3 -3,3c-1.66797,0 -3,-1.33203 -3,-3c0,-1.66797 1.33203,-3 3,-3zM5,42c1.66797,0 3,1.33203 3,3c0,1.66797 -1.33203,3 -3,3c-1.66797,0 -3,-1.33203 -3,-3c0,-1.66797 1.33203,-3 3,-3zM19,42c1.66797,0 3,1.33203 3,3c0,1.66797 -1.33203,3 -3,3c-1.66797,0 -3,-1.33203 -3,-3c0,-1.66797 1.33203,-3 3,-3zM31,42c1.66797,0 3,1.33203 3,3c0,1.66797 -1.33203,3 -3,3c-1.66797,0 -3,-1.33203 -3,-3c0,-1.66797 1.33203,-3 3,-3zM45,42c1.66797,0 3,1.33203 3,3c0,1.66797 -1.33203,3 -3,3c-1.66797,0 -3,-1.33203 -3,-3c0,-1.66797 1.33203,-3 3,-3z">
                                        </path>
                                    </g>
                                </g>
                            </svg>
                            <span class="p-text-enroll">Active Since</span>
                        </div>

                        <span class="h1-text-enroll">{{date}}</span>
                    </div>
                </div>
            </div>

            <div class="flex flex-col profile-bio">
                <span class="h1-text">Bio</span>
                <span class="p-text">{{ request.user.customuser.bio }}</span>
            </div>
        </div>
    </section>
    <!--  Pop Up's -->
    <div id="popupMessage" class="popup-message" style="display: none;">
        <div class="flex-pops">
            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 48 48">
                <linearGradient id="4UU4ptC_mBgYTIFHxQVZaa_hP6pCUyT8QGk_gr1" x1="-308.751" x2="36.906" y1="-346.874"
                    y2="49.567" gradientUnits="userSpaceOnUse">
                    <stop offset="0" stop-color="#ffda1c"></stop>
                    <stop offset="1" stop-color="#feb705"></stop>
                </linearGradient>
                <path fill="url(#4UU4ptC_mBgYTIFHxQVZaa_hP6pCUyT8QGk_gr1)"
                    d="M44.634,37.846L25.76,7.787c0,0-0.508-1.05-1.76-1.05s-1.76,1.05-1.76,1.05L3.366,37.846	C3.366,37.846,3,38.337,3,39c0,1.105,0.895,2,2,2h38c1.105,0,2-0.895,2-2C45,38.337,44.634,37.846,44.634,37.846z">
                </path>
                <radialGradient id="4UU4ptC_mBgYTIFHxQVZab_hP6pCUyT8QGk_gr2" cx="18.189" cy="16.781" r="22.363"
                    gradientUnits="userSpaceOnUse">
                    <stop offset="0" stop-color="#4b4b4b"></stop>
                    <stop offset=".531" stop-color="#393939"></stop>
                    <stop offset="1" stop-color="#252525"></stop>
                </radialGradient>
                <path fill="url(#4UU4ptC_mBgYTIFHxQVZab_hP6pCUyT8QGk_gr2)"
                    d="M24.014,37c-0.732,0-1.336-0.222-1.812-0.666c-0.476-0.444-0.714-0.981-0.714-1.613 c0-0.659,0.24-1.199,0.721-1.62c0.48-0.421,1.082-0.631,1.805-0.631c0.732,0,1.332,0.213,1.798,0.638 c0.467,0.426,0.7,0.963,0.7,1.613c0,0.659-0.231,1.203-0.693,1.633S24.755,37,24.014,37z M26.236,17.721l-0.481,12.175 c-0.015,0.372-0.321,0.666-0.693,0.666h-2.179c-0.373,0-0.679-0.295-0.693-0.668L21.735,17.72c-0.015-0.393,0.3-0.72,0.693-0.72 h3.116C25.937,17,26.252,17.327,26.236,17.721z">
                </path>
            </svg>
            <span id="popupSpan" class="span-popup"></span>
            <button id="popUpCloseButton" class="pop-up-close-button" onclick="closePopup()">Close</button>
        </div>
    </div>
</main>

<script>
    function editField(button, field) {
        var parentDiv = $(button).closest('.card-item');
        var infoSection = parentDiv.find('.info-section');
        var textSpan = infoSection.find('.secondary-text');
        var inputField = infoSection.find('.edit-field');
        if ($(button).text() === 'Change') {
            textSpan.hide();
            inputField.val(textSpan.text().trim()).show();
            $(button).text('Confirm');
        } else {
            textSpan.text(inputField.val()).show();
            inputField.hide();
            $(button).text('Change');
            updateField(field, inputField.val());
        }
    }

    function updateField(field, value) {
        $.ajax({
            type: 'POST',
            url: '{% url "update_user_info" %}',
            data: JSON.stringify({
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                [field]: value
            }),
            contentType: 'application/json',
            success: function (response) {
                if (response.status !== 'success') {
                    showPopup(response.message);
                } else {
                    showPopup('Updated successfully.');
                }
            },
            error: function (response) {
                showPopup('Error, please try again.');
            }
        });
    }

    function showPopup(message) {
        $('#popupSpan').text(message);
        $('#popupMessage').show();
    }

    function closePopup() {
        $('#popupMessage').hide();
    }

    function goBack() {
        window.history.back();
        return false; // Prevent default link behavior
    }
</script>

{% endblock main %}

{% block footer %}{% endblock footer %}

{% block scripts %}
{% endblock scripts %}
