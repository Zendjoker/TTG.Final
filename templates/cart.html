{% extends "base.html" %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static "styles/cart.css" %}">
    {% block title %}
        <title>Cart - Tunisian Top Gs</title>
    {% endblock title %}
{% endblock head %}

{% block main %}
    {% include "components/navbar.html" %}

    <div class='wrapper-container-all'>
    <div class="h1-text">Shopping Cart</div>
    <div class="cart-wrapper">
        
        <div class="shopping-cart">
            <div class="items-container">
                {% if cart.cart_items.count == 0 %}
                <div class="empty-cart" id="emptyCart">
                    <!-- Empty cart message -->
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0,0,256,256">
                        <g fill="#ffffff" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(2.56,2.56)"><path d="M29.32227,9.56445c-0.14408,0.00908 -0.27405,0.02432 -0.38477,0.03516c-7.75364,0.76674 -15.75459,1.91782 -23.43164,3.125c-0.1396,-0.0011 -0.27817,0.01512 -0.41406,0.06445c-0.291,0.106 -0.67991,0.36695 -0.87891,1.00195c-0.51,1.609 0.06453,3.45723 1.39453,4.49023c0.05697,0.04472 0.11629,0.06254 0.17383,0.09961c2.62847,7.76085 5.15027,15.66362 7.49414,23.5c2.496,8.347 4.87264,16.88464 7.18164,25.18164c0.316,1.135 0.83303,2.78295 1.33203,4.37695c0.37802,1.20507 0.70326,2.28562 1.00195,3.29492c-0.20409,0.05217 -0.40947,0.11625 -0.61719,0.20117c-5.74506,2.34873 -1.57411,13.03628 4.08789,11.45508c1.52459,-0.29576 2.82398,-1.09671 3.61328,-2.25586c0.86867,-1.27232 1.1276,-2.89731 0.78125,-4.83594c8.2511,1.68425 15.8747,3.47527 22.70898,5.3457c-2.09457,4.42562 2.53717,12.1193 7.74219,9.96094c0.07722,-0.0286 0.15131,-0.05949 0.22656,-0.08984c0.00136,-0.00064 0.00255,-0.00132 0.00391,-0.00195c1.5375,-0.62116 2.6658,-1.60287 3.28125,-2.88281c0.818,-1.701 0.71541,-3.8143 -0.30859,-6.2793c-0.09649,-0.2323 -0.19669,-0.43226 -0.29687,-0.62695c3.04456,-1.36863 6.44377,-2.82239 9.71094,-4.26172c0.05422,0.80586 0.23997,1.60466 0.55469,2.35156c0.56742,1.34661 1.51341,2.54588 2.78516,3.27539c0.98274,0.56373 2.18339,0.80434 3.41992,0.57422c0.31319,-0.03141 0.62523,-0.08139 0.93555,-0.17383c2.92,-0.88 4.53938,-4.33117 3.60938,-7.70117c-0.49,-1.77 -1.61961,-3.25836 -3.09961,-4.06836c-0.802,-0.4427 -1.66593,-0.66494 -2.52539,-0.66602c-2.37121,-0.38806 -5.95739,-1.17043 -8.75195,-1.78711c4.37286,-1.88154 8.70458,-3.87965 12.87305,-6.07031c0.20694,-0.10856 0.36933,-0.28615 0.45898,-0.50195c4.3551,-10.49684 8.24168,-22.31014 11.66406,-33.09766c0.08912,-0.28158 0.04922,-0.58816 -0.109,-0.83755c-0.15822,-0.24939 -0.41859,-0.41609 -0.71131,-0.45542c-2.23623,-0.30173 -7.59849,-0.68839 -13.66797,-1.19141c-6.06947,-0.50302 -12.80599,-1.11617 -17.55664,-1.83008c-1.0916,-0.16422 -6.43746,-0.71532 -12.41016,-1.37109c-5.93545,-0.65169 -12.36903,-1.38928 -15.2207,-1.84961c-0.69678,-2.16922 -1.68566,-5.39732 -2.54102,-8.20117c-0.43451,-1.42432 -0.83359,-2.73271 -1.13867,-3.72656c-0.30508,-0.99385 -0.47896,-1.57882 -0.59375,-1.88477c-0.00065,-0.00065 -0.0013,-0.0013 -0.00195,-0.00195c-0.11944,-0.31619 -0.28307,-0.85818 -0.84766,-1.27734c-0.35939,-0.26689 -0.72565,-0.37055 -1.05859,-0.40234c-0.16647,-0.0159 -0.32467,-0.01298 -0.46875,-0.00391zM29.6582,11.57617c-0.03659,-0.02717 0.05546,0.08115 0.16797,0.37891c0.0038,0.01025 0.21531,0.68428 0.4043,1.28906c-7.20285,1.28542 -14.81716,2.30365 -22.10352,3.36914c0.02604,-0.55981 -0.01405,-1.24215 -0.29492,-1.89648c-0.04529,-0.10574 -0.10269,-0.20294 -0.1582,-0.30078c7.08696,-1.0973 14.38326,-2.12647 21.45898,-2.82617c0.39515,-0.03867 0.56818,0.0181 0.52539,-0.01367zM28.42383,15.58203c0.33785,0.85634 1.08054,3.07616 1.85742,5.41406c0.51509,1.55066 1.08677,3.26302 1.65625,4.93945c-5.64578,1.29188 -12.47074,2.50878 -18.88867,4.03516c-0.18283,-0.65808 -0.41667,-1.47757 -0.57227,-2.05078l-0.08594,-0.31836c-0.563,-2.077 -1.14481,-4.22569 -1.88281,-6.30469c-0.125,-0.354 -0.23398,-0.67084 -0.33398,-0.96484c-0.22254,-0.65237 -0.44594,-1.24903 -0.71484,-1.89062c6.24033,-0.90414 12.69258,-1.79519 18.96484,-2.85937zM36.15039,27.10742c2.73107,0.41913 7.66377,0.99216 12.65234,1.54688c0.0983,0.67535 0.47667,3.35704 0.85938,6.86523c-3.93556,-0.52102 -7.85202,-1.05445 -11.78516,-1.60547c-0.72358,-2.54986 -1.18734,-4.54452 -1.72656,-6.80664zM34.17969,27.45703c0.48995,2.05311 0.92091,3.91429 1.53516,6.15234c-1.6412,-0.23244 -3.28615,-0.45994 -4.91992,-0.69727l-1.53516,-4.3418c1.71665,-0.36417 3.36942,-0.73341 4.91992,-1.11328zM50.85352,28.88672c0.04106,0.00451 0.08008,0.00917 0.12109,0.01367c5.33514,0.58577 9.45562,1.02746 11.00391,1.21484v6.99609c-3.41153,-0.42723 -6.82731,-0.87005 -10.27539,-1.32227c-0.35186,-3.31311 -0.68574,-5.75185 -0.84961,-6.90234zM27.28516,28.97852l1.27734,3.61719c-3.63312,-0.53403 -7.19727,-1.09176 -10.75977,-1.64844c3.20896,-0.68938 6.3993,-1.33274 9.48242,-1.96875zM63.97852,30.35156c3.54597,0.50911 7.93404,0.93949 12.35742,1.33398l-1.20703,5.94922c-0.91609,0.26079 -1.89929,0.54763 -2.69922,0.76758c-2.77642,-0.33227 -5.62628,-0.69426 -8.45117,-1.04492zM78.33984,31.86719c0.88724,0.07624 1.78679,0.16638 2.6543,0.23828c3.77755,0.31307 6.72965,0.5593 9.17969,0.7793c-4.39013,1.55553 -8.95069,2.98171 -12.87891,4.13281zM13.71289,32.34375c3.6939,0.59054 7.47442,1.16012 11.25781,1.72656c0.50973,3.17315 1.01955,6.34626 1.5293,9.51953c-3.31208,-0.45321 -6.62344,-0.90638 -9.93555,-1.35937c-1.06181,-3.63383 -2.02804,-6.97601 -2.85156,-9.88672zM93.10352,33.95117c-1.01363,3.17741 -2.07511,6.41664 -3.16406,9.67578c-1.17723,0.48832 -2.45147,0.8033 -3.66406,1.2207c1.05917,-3.18475 2.20607,-6.38559 3.0957,-9.52539c0.00281,-0.01167 0.00542,-0.02339 0.00781,-0.03516c1.25687,-0.43388 2.49844,-0.8811 3.72461,-1.33594zM27.04883,34.38867c3.15839,0.46749 6.34248,0.91213 9.53125,1.36133c0.24465,0.15699 0.5455,0.19977 0.82422,0.11719c0.55709,0.07815 1.11044,0.15876 1.66797,0.23633c-0.00152,0.02406 -0.00217,0.04816 -0.00195,0.07227c-0.02101,3.05974 0.17237,6.11601 0.19922,9.17578c-0.97219,-0.13348 -1.94418,-0.28109 -2.91602,-0.41406c-0.00065,0 -0.0013,0 -0.00195,0c-2.5932,-0.35466 -5.18602,-0.70961 -7.7793,-1.06445c-0.50786,-3.16154 -1.01553,-6.32296 -1.52344,-9.48437zM87.06445,36.05273c-0.94508,3.16203 -2.06599,6.38226 -3.15039,9.5918c-1.77223,0.54854 -3.48695,1.21091 -5.29297,1.73828c0.99194,-3.20952 2.09271,-6.38495 3.06055,-9.60156c1.75846,-0.5409 3.54569,-1.11815 5.38281,-1.72852zM41.07227,36.38672c4.29815,0.59219 8.58311,1.16132 12.86523,1.7168c-0.22883,3.07749 -0.57235,6.14506 -0.87109,9.2168c-3.92798,-0.59831 -7.85773,-1.14239 -11.78906,-1.68555c-0.02865,-3.08374 -0.21739,-6.16447 -0.20508,-9.24805zM55.92383,38.36523c4.83236,0.62128 9.61274,1.21541 14.33398,1.78516l-2.74609,9.61719c-4.14485,-0.78553 -8.30564,-1.45898 -12.46875,-2.10937c0.30243,-3.09714 0.64729,-6.19016 0.88086,-9.29297zM79.37891,38.47852c-0.99559,3.21114 -2.08222,6.39462 -3.08008,9.60547c-1.82144,0.56202 -3.63766,1.16344 -5.42383,1.88281l2.81055,-9.83984c1.6895,-0.4689 3.61235,-1.02714 5.69336,-1.64844zM17.18555,44.33398c3.21541,0.43956 6.4311,0.87838 9.64648,1.31836c0.50024,3.1141 1.00172,6.22769 1.50195,9.3418c-2.80094,-0.42823 -5.59157,-0.92204 -8.39648,-1.32227c-0.92582,-3.12181 -1.84246,-6.23641 -2.75195,-9.33789zM28.9043,45.93555c2.39257,0.32738 4.78514,0.65521 7.17773,0.98242c1.0791,0.14765 2.15366,0.31074 3.23242,0.45898c0.03823,3.12612 0.11694,6.24988 0.20508,9.375c-3.03052,-0.5148 -6.07222,-0.95775 -9.10937,-1.43164c-0.50251,-3.12826 -1.00335,-6.2565 -1.50586,-9.38477zM89.08984,46.14258c-0.9003,2.64928 -1.811,5.29175 -2.76172,7.9082c-0.06097,0.00748 -0.12112,0.02055 -0.17969,0.03906c-1.14057,0.37525 -2.2523,0.83321 -3.38477,1.23242c0.94715,-2.64123 1.7667,-5.23527 2.67383,-7.89062c1.22522,-0.39482 2.44416,-0.81965 3.65234,-1.28906zM41.32031,47.66016c3.85675,0.53362 7.71292,1.06802 11.55664,1.6543c-0.33203,3.23241 -0.69248,6.45904 -1.10937,9.68164c-3.41418,-0.64414 -6.81857,-1.3357 -10.24219,-1.92773c-0.09044,-3.13599 -0.16507,-6.27117 -0.20508,-9.4082zM83.10547,48.13672c-0.9398,2.71847 -1.81044,5.3684 -2.78516,8.07617c-1.71336,0.63342 -3.4347,1.24172 -5.12695,1.92969c0.89566,-2.76969 1.78266,-5.54176 2.65039,-8.32031c1.76139,-0.52598 3.4776,-1.15317 5.26172,-1.68555zM54.85547,49.65234c4.04551,0.63305 8.08329,1.29841 12.10156,2.05664l-2.76367,9.67383c-3.4797,-0.70243 -6.97229,-1.3394 -10.45898,-2.00781c0.41979,-3.23652 0.78646,-6.47624 1.12109,-9.72266zM75.49219,50.61719c-0.90094,2.86787 -1.80751,5.73346 -2.73828,8.5918c-1.7251,0.73281 -3.44949,1.46675 -5.15625,2.24023l2.58008,-9.03711c0.06308,-0.01484 0.12457,-0.03577 0.18359,-0.0625c1.62985,-0.72454 3.41295,-1.17489 5.13086,-1.73242zM20.5625,55.79102c2.70467,0.40263 5.40056,0.86345 8.10352,1.2793c0.51268,3.19156 1.02626,6.38281 1.53906,9.57422c-2.22373,-0.54247 -4.443,-1.09668 -6.65039,-1.67383c-0.08611,-0.02209 -0.17478,-0.0326 -0.26367,-0.03125c-1.04175,-3.4802 -1.31563,-4.39289 -2.72852,-9.14844zM85.44336,56.46289c-1.03063,2.76662 -2.08899,5.49008 -3.17773,8.12695c-1.13401,0.59314 -2.28831,1.16512 -3.44141,1.73828c1.00254,-2.82495 2.02763,-5.68335 3.06445,-8.55859c1.18673,-0.43132 2.36691,-0.8794 3.55469,-1.30664zM30.74414,57.39648c2.93978,0.46157 5.88484,0.88671 8.81836,1.38672c0.10637,3.35892 0.07466,6.72089 0.20703,10.07813c-2.49257,-0.54788 -4.97858,-1.11585 -7.45703,-1.70703c-0.52253,-3.25261 -1.04585,-6.50507 -1.56836,-9.75781zM79.44531,58.6582c-1.07788,2.98635 -2.16923,6.00348 -3.19336,8.92188c-1.56781,0.74917 -3.14601,1.47774 -4.73633,2.18164c0.98038,-3.01989 1.88283,-6.06567 2.86914,-9.08398c1.67666,-0.70141 3.36217,-1.37253 5.06055,-2.01953zM41.57031,59.09961c3.31573,0.57533 6.61114,1.25455 9.91797,1.87891c-0.4507,3.34195 -0.88001,6.68752 -1.41016,10.01758c-2.76796,-0.53924 -5.53232,-1.10263 -8.29102,-1.69531c-0.15281,-3.39775 -0.10693,-6.80131 -0.2168,-10.20117zM53.45313,61.35742c3.39672,0.65166 6.79907,1.27328 10.18945,1.95508l-2.75586,9.65234c-2.94865,-0.49928 -5.89796,-1.02741 -8.8457,-1.58789c0.53134,-3.33083 0.96026,-6.67666 1.41211,-10.01953zM71.94727,61.74414c-0.99336,3.01898 -1.87805,6.07291 -2.89453,9.08398c-1.55427,0.65928 -3.11227,1.29103 -4.67578,1.89844l2.50586,-8.77734c0.05296,-0.01525 0.10457,-0.03484 0.1543,-0.05859c1.61339,-0.76688 3.27313,-1.43117 4.91016,-2.14648zM23.94727,67.13477c3.79764,0.98392 7.6212,1.9148 11.46094,2.79688l-9.47852,3.84375c-0.19761,-0.66862 -1.32925,-4.45962 -1.98242,-6.64062zM40.48047,71.06641c7.43145,1.61411 14.9083,3.04192 22.37109,4.26563c0.17191,0.02859 0.34831,0.01176 0.51172,-0.04883c0.90087,-0.33788 1.79414,-0.72003 2.6875,-1.10156c0.06412,0.02706 0.13089,0.04735 0.19922,0.06055l9.11523,1.82617c-4.78588,1.93675 -9.75041,3.87977 -15.66797,6.3125c-0.63497,-0.29199 -1.31178,-0.45177 -2.01562,-0.44922c-6.32515,-1.22258 -13.37265,-2.7906 -20.2207,-4.32031c-2.93959,-0.65604 -5.62215,-1.24207 -8.29102,-1.82227zM23.56836,76.625c3.15583,-0.31887 5.67681,6.4208 2.45898,7.73633c-0.1607,0.0657 -0.31992,0.0932 -0.47852,0.12109c-0.0051,0.00061 -0.01457,0.00333 -0.01953,0.00391c-0.00702,0.00081 -0.01256,0.00491 -0.01953,0.00586c-3.21121,0.50582 -5.83862,-6.3729 -2.58008,-7.70508c0.21452,-0.0877 0.42828,-0.14085 0.63867,-0.16211zM80.53906,77.22852c0.73695,0.4811 1.38147,1.27558 1.77148,2.20117c0.41945,0.99546 0.53901,2.10489 0.30664,3.00586c-0.23237,0.90097 -0.74449,1.6097 -1.81445,2.06055c-1.06997,0.45085 -1.93705,0.3243 -2.74414,-0.13867c-0.80709,-0.46297 -1.51805,-1.3229 -1.9375,-2.31836c-0.34032,-0.80766 -0.46909,-1.68527 -0.38672,-2.4707c1.80162,-0.8176 3.47044,-1.61257 4.80469,-2.33984zM57.62109,83.93945c3.37146,-0.07187 6.17025,6.29869 3.39648,8.43555c-0.40538,0.2579 -0.80822,0.43775 -1.11328,0.52539h-0.00195c-3.79566,0.86958 -7.21826,-6.90228 -3.40234,-8.69141c0.37597,-0.17628 0.75215,-0.26167 1.12109,-0.26953z"></path></g></g>
                        </svg>

                    <div class="empty-cart-container">
                        
                        <span class="f">Your cart is empty</span>
                        <a href="/shop" class="btn">Continue Shopping</a>
                    </div>
                </div>
                {% else %}
                <div class="items-list" id="items-list">
                    {% for item in cart.cart_items.all %}
                        <div class="item-container p{{ item.id }}">
                            <button class="delete-icon" data-item-id="{{ item.id }}">
                                Delete
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                            </button>
                            <div class="input-group quantity-selector quantity-selector-sm">
                                <button type="button" class="btn btn-icon btn-secondary btn-sm" aria-describedby="inputQuantitySelectorSm" data-bs-step="down">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-minus"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></svg>
                                </button>
                                <input type="number" id="inputQuantitySelectorSm" class="form-control" aria-live="polite" data-bs-step="counter" name="quantity" title="quantity" value="0" min="0" max="10" step="1" data-bs-round="0" aria-label="Quantity selector">
                                <button type="button" class="btn btn-icon btn-secondary btn-sm" aria-describedby="inputQuantitySelectorSm" data-bs-step="up">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-plus"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>
                                </button>
                              </div>
                            <div class="item-description">
                                <img src="{{item.product.image.url}}" alt="product-img" />
                                <div class="item-recap">
                                    <span class="h1-text">{{item.product.title}}</span>
                                    <span class="item-size">size: <span class="p-text">{{item.size}}</span></span>
                                    <span class="item-color">color: <span class="p-text">{{item.color}}</span></span>
                                    <div class="item-price">
                                        <span class="h1-text">{{item.product.price}} DT</span>
                                     
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="all-oreder-paynments">
        <div class="order">
            <div class="order-container">
                <div class="order-details">
                    <span class="h1-text">Order Summary</span>
                    <div class="price">
                        <span class="p-text">Price</span>
                        <span class="p-text subTotal">TND {{cart.calculate_total_price}}</span>
                    </div>
                    <div class="discount">
                        <span class="p-text">Discount</span>
                        <span class="p-text">$0</span>
                    </div>
                    {% comment %} <div class="shipping">
                        <span class="p-text">Shipping</span>
                        <span class="p-text greener shippingtotal">Free</span>
                    </div> {% endcomment %}
                    <div class="coupon">
                        <span class="p-text">Coupon Applied</span>
                        <span class="p-text">$0.00</span>
                    </div>
                </div>
                <div class="divisier"></div>
                <div class="order-total">
                    <div class="total">
                        <span class="p-text">Total</span>
                        <span class="p-text TTotal">TND {{cart.calculate_total_price}}</span>
                    </div>
                    {% comment %} <div class="delivery">
                        <span class="p-text">Estimated Delivery by</span>
                        <span class="p-text">âˆž</span>
                    </div> {% endcomment %}
                    <input class="cupon-input" placeholder="Coupon Code" />
                    <button class='cupon cupon-btn'>Get Coupon Code</button>
                    <a class="btn goCheckout checkoutbtn">
                        <span id="buttonText">Proceed to Checkout</span>
                        <span id="loadingIcon" style="display: none;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-ccw spinner"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg></span> <!-- Simple emoji spinner, replace with your preferred icon -->
                    </a>
                    
                </div>
            </div>
        </div>
        <div class="payment-accept-container">
                <span class="text-accept">We accept the following payment methods: </span>
                <div class="payments-methods">
                    <img class="flex-item" src="{% static "assets/payments/Visa.webp" %}" alt="cart empty" />
                    <img class="flex-item" src="{% static "assets/payments/mastercard.svg" %}" alt="cart empty" />
                    <img class="flex-item" src="{% static "assets/payments/apple-pay.svg" %}" alt="cart empty" />
                    <!-- <img class="flex-item" src="{% static "assets/payments/D17.png" %}" alt="cart empty" /> -->
                    <img class="flex-item" src="{% static "assets/payments/usdt.png" %}" alt="cart empty" />
                    <img class="flex-item" src="{% static "assets/payments/venmo.svg" %}" alt="cart empty" />
                    <img class="flex-item" src="{% static "assets/payments/paypal.svg" %}" alt="cart empty" />
                    <img class="flex-item" src="{% static "assets/payments/zelle.svg" %}" alt="cart empty" />
                    <!-- <img class="flex-item" src="{% static "assets/payments/cashapp.png" %}" alt="cart empty" /> -->
                    <img class="flex-item" src="{% static "assets/payments/Googlepay.svg" %}" alt="cart empty" />
                    
                </div>
        </div>
    </div>

    </div>
</div>
    <!--   ========================================================= -->
<!--  Pop Up's Deleted item -->
<!--   =========================================================-->
<div id="popupMessage" class="popup-message">
    <div class="flex-pops">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
        <span id="popupSpan" class="span-popup">Item has been deleted.</span>
        <button id="popUpCloseButton" class="pop-up-close-button">Close</button>
    </div>
</div>
<!--   =========================================================-->

{% endblock main %}

{% block scripts %}
<script type='text/javascript'>
  document.addEventListener('DOMContentLoaded', function() {
      // Define variables
      const subTotalDiv = document.querySelector(".subTotal");
      const TotalDiv = document.querySelector('.TTotal');

      const deleteButtons = document.querySelectorAll('.delete-icon');
      const shippingTotalDiv = document.querySelector('.shippingtotal');
      let TotalPrice = {{cart.calculate_total_price}}
      let shippingCost = 0
      
      function reloadPrices(totalPrice, shippingMethod) {
          subTotalDiv.innerText = `TND ${totalPrice}`
          TotalDiv.innerText = `TND ${totalPrice + calculateShippingCost(shippingMethod)}`;
          TotalPrice = totalPrice
      }

      // Add event listeners to all delete buttons
      deleteButtons.forEach(button => {
        button.addEventListener('click', function () {
            const itemId = button.dataset.itemId;
            $.ajax({
                type: 'POST',
                url: '/delete-cart-item/',
                data: { itemId: itemId },
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader('X-CSRFToken', getCookie("csrftoken"));
                },
                success: function (response) {
                    console.log(response);
                    document.getElementById('popupMessage').style.display = 'flex';
                    document.querySelector(`.item-container.p${itemId}`).remove()
                    setTimeout(function() {
                        document.getElementById('popupMessage').style.display = 'none'; // Automatically close popup before reloading
                    }, 3000); // Delay in milliseconds
                },
                error: function (xhr, status, error) {
                    console.error('Error deleting cart item:', error);
                }
            });
        });
    });

      // Event listener for checkout button
       const checkoutButton = document.querySelector('.checkoutbtn');
    const buttonText = document.getElementById('buttonText');
    const loadingIcon = document.getElementById('loadingIcon');

    checkoutButton.addEventListener('click', function(event) {
        event.preventDefault();

        // Change button text and show loading icon
        buttonText.textContent = 'Processing...';
        loadingIcon.style.display = 'inline-block';

        // Set timeout to simulate 0.8 seconds of processing time
        setTimeout(function() {
            // Here you can place your AJAX call or other logic
            // For demonstration, we'll just redirect
            loadingIcon.style.display = 'none'; // Hide loading icon
            buttonText.textContent = 'Proceed to Checkout'; // Reset button text if needed

            console.log("Processing complete, redirecting or performing next steps.");
            window.location.href = '/checkout'; // Redirect or perform other actions

            // If using AJAX, put your AJAX call inside this timeout function
             $.ajax({
                type: 'POST',
                url: '/final-cart-checkout/',
                data: { cartId: {{cart.id}}, price: {{cart.price}} + 7, shippingMethod: 1, shippingCost: 7 },
                beforeSend: function(xhr, settings) {
                    xhr.setRequestHeader('X-CSRFToken', getCookie("csrftoken"));
                },
                success: function(response) {
                    console.log("Checkout successful:", response);
                    window.location.href = `/checkout`;
                },
                error: function(xhr, status, error) {
                    console.error('Error during checkout:', error);
                    buttonText.textContent = 'Proceed to Checkout'; // Revert button text
                    loadingIcon.style.display = 'none'; // Hide loading icon
                }
            }); 
        }, 1500); // 800 milliseconds equals 0.8 seconds
    });
  
  
      // Function to get cookie value
      function getCookie(name) {
          let cookieValue = null;
          if (document.cookie && document.cookie !== '') {
              const cookies = document.cookie.split(';');
              for (let i = 0; i < cookies.length; i++) {
                  const cookie = cookies[i].trim();
                  if (cookie.substring(0, name.length + 1) === (name + '=')) {
                      cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                      break;
                  }
              }
          }
          return cookieValue;
      }
     
      

      const decrementButton = document.querySelector('button[data-bs-step="down"]');
      const incrementButton = document.querySelector('button[data-bs-step="up"]');
      const input = document.getElementById('inputQuantitySelectorSm');
  
      decrementButton.addEventListener('click', function() {
          // Decrement the value
          let currentValue = parseInt(input.value);
          if (currentValue > parseInt(input.min)) { // Check if greater than min
              input.value = currentValue - 1;
          }
      });
  
      incrementButton.addEventListener('click', function() {
          // Increment the value
          let currentValue = parseInt(input.value);
          if (currentValue < parseInt(input.max)) { // Check if less than max
              input.value = currentValue + 1;
          }
      });
  });

  document.querySelector(".cupon-btn").addEventListener('click', function() {
    var cupon = document.querySelector(".cupon-input").value; // Added var keyword to define cupon variable
    ajaxRequest("POST", "/apply_coupon/", {cupon: cupon}, function(response) { // Changed cupon to coupon
    }, null, true, "Apply Coupon", null); // Changed Cupon to Coupon
});
  </script>



{% endblock scripts %}
